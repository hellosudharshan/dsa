import speech_recognition as sr
import pyttsx3
from textblob import TextBlob
import tkinter as tk
from threading import Thread

# --- SETUP THE BRAIN & MOUTH ---
engine = pyttsx3.init()
r = sr.Recognizer()

def update_lumi():
    while True:
        with sr.Microphone() as source:
            # Update label to show she's listening
            status_label.config(text="Listening...", fg="#FFB6C1")
            audio = r.listen(source)

        try:
            text = r.recognize_google(audio)
            analysis = TextBlob(text)
            sentiment = analysis.sentiment.polarity

            # Logic to change the Face and the Response
            if sentiment > 0.1:
                face_label.config(text="キュ (•◡•) ✨", fg="#FF69B4") # Cute Happy Face
                response = "You sound so happy! I love that energy!"
            elif sentiment < -0.1:
                face_label.config(text="(◕︿◕) ☁️", fg="#ADD8E6") # Cute Sad Face
                response = "Oh no, I'm sending you a big hug. It's okay to feel sad."
            else:
                face_label.config(text="○( ◕‿◕ )○", fg="#D8BFD8") # Neutral/Calm Face
                response = "I'm listening, darling. Tell me more."

            status_label.config(text=f"I heard: {text}", fg="white")
            engine.say(response)
            engine.runAndWait()

        except:
            status_label.config(text="I'm here for you...", fg="gray")

# --- SETUP THE WINDOW (The Body) ---
root = tk.Tk()
root.title("Lumi Empath")
root.geometry("400x400")
root.configure(bg="#2C2C2C") # Dark aesthetic

# The Face
face_label = tk.Label(root, text="○( ◕‿◕ )○", font=("Helvetica", 40), bg="#2C2C2C", fg="#D8BFD8")
face_label.pack(expand=True)

# The Status Text
status_label = tk.Label(root, text="Waiting for you...", font=("Helvetica", 12), bg="#2C2C2C", fg="white")
status_label.pack(pady=20)

# Start the 'Ear' in a separate thread so the window doesn't freeze
Thread(target=update_lumi, daemon=True).start()

root.mainloop()
